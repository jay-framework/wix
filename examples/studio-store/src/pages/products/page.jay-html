<html>
  <head>
    <script type="application/jay-headless"
            plugin="@jay-framework/wix-stores"
            contract="product-search"
            key="productSearch"
    ></script>
    <script type="application/jay-headless"
            plugin="@jay-framework/wix-stores"
            contract="cart-indicator"
            key="cartIndicator"
    ></script>
    <script type="application/jay-data">
      data:
    </script>
    <link rel="stylesheet" href="../../styles/brutalist-theme.css" />
    <style>
      /* =====================================================
         STUDIO PRODUCTS PAGE - BRUTALIST ASYMMETRIC LAYOUT
         ===================================================== */
      
      .products-page {
        min-height: 100vh;
      }

      /* Hero Section - Bold Typography */
      .page-hero {
        padding: 80px var(--page-padding) 48px;
        max-width: var(--container-max);
        margin: 0 auto;
      }

      .page-hero .page-title {
        margin-bottom: 16px;
      }

      .page-hero .page-subtitle {
        max-width: 500px;
      }

      /* Stats Bar */
      .stats-bar {
        display: flex;
        gap: 48px;
        margin-top: 32px;
        padding-top: 32px;
        border-top: 2px solid var(--border-light);
      }

      .stat-item {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .stat-value {
        font-family: var(--font-mono);
        font-size: 32px;
        font-weight: 700;
        color: var(--accent-dark);
      }

      .stat-label {
        font-family: var(--font-mono);
        font-size: 10px;
        color: var(--text-muted);
        text-transform: uppercase;
        letter-spacing: 0.15em;
      }

      /* Search Section */
      .search-section {
        max-width: var(--container-max);
        margin: 0 auto;
        padding: 0 var(--page-padding) 48px;
      }

      .search-section .search-box {
        max-width: 700px;
      }

      /* Main Layout */
      .main-content {
        max-width: var(--container-max);
        margin: 0 auto;
        padding: 0 var(--page-padding) 80px;
        display: grid;
        grid-template-columns: 260px 1fr;
        gap: 48px;
      }

      /* Results Header */
      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 24px;
        padding-bottom: 16px;
        border-bottom: 2px solid var(--border);
      }

      .results-count {
        font-family: var(--font-mono);
        font-size: 12px;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.1em;
      }

      .results-count strong {
        color: var(--text-primary);
        font-weight: 700;
      }

      /* Category Pills - Horizontal Scroll */
      .category-pills {
        display: flex;
        gap: 8px;
        margin-bottom: 24px;
        overflow-x: auto;
        padding-bottom: 8px;
      }

      .category-pill {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 18px;
        background: var(--bg-primary);
        border: 2px solid var(--border);
        font-family: var(--font-mono);
        font-size: 11px;
        font-weight: 700;
        color: var(--text-secondary);
        text-transform: uppercase;
        letter-spacing: 0.05em;
        cursor: pointer;
        white-space: nowrap;
        transition: all var(--transition-fast);
      }

      .category-pill:hover {
        border-color: var(--text-primary);
        color: var(--text-primary);
      }

      .category-pill.selected {
        background: var(--bg-inverse);
        border-color: var(--bg-inverse);
        color: var(--text-inverse);
      }

      .category-pill input {
        display: none;
      }

      /* Grid with featured first */
      .products-grid-featured {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
      }

      .products-grid-featured .product-card:first-child {
        grid-column: span 2;
        grid-row: span 2;
      }

      .products-grid-featured .product-card:first-child .product-card-image {
        aspect-ratio: 4/5;
      }

      .products-grid-featured .product-card:first-child .product-card-name {
        font-size: 22px;
      }

      .products-grid-featured .product-card:first-child .current-price {
        font-size: 26px;
      }

      .products-grid-featured .product-card:first-child .overlay-name {
        font-size: 22px;
      }

      .products-grid-featured .product-card:first-child .overlay-price {
        font-size: 18px;
      }

      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
        }

        .filters-sidebar {
          position: static;
        }

        .products-grid-featured {
          grid-template-columns: repeat(2, 1fr);
        }

        .products-grid-featured .product-card:first-child {
          grid-column: span 2;
          grid-row: span 1;
        }
      }

      @media (max-width: 768px) {
        .stats-bar {
          gap: 24px;
          flex-wrap: wrap;
        }

        .stat-value {
          font-size: 24px;
        }
      }

      @media (max-width: 600px) {
        .page-hero {
          padding: 48px var(--page-padding) 32px;
        }

        .products-grid-featured {
          grid-template-columns: 1fr;
        }

        .products-grid-featured .product-card:first-child {
          grid-column: span 1;
        }
      }
    </style>
  </head>
  <body>
    <div class="products-page">
      <!-- Site Header -->
      <header class="site-header">
        <div class="header-inner">
          <a href="/products" class="site-logo">
            STUDIO<span class="logo-dot"></span>
          </a>
          <nav class="site-nav">
            <a href="/products" class="active">Products</a>
            <a href="/cart" 
               class="cart-indicator {cartIndicator.hasItems ? has-items} {cartIndicator.isLoading ? is-loading} {cartIndicator.justAdded ? just-added}"
               ref="cartIndicator.cartLink">
              <span class="cart-indicator-icon">BAG</span>
              <span class="cart-indicator-count" if="cartIndicator.hasItems">{cartIndicator.itemCount}</span>
            </a>
          </nav>
        </div>
      </header>

      <!-- Loading Overlay -->
      <div class="loading-overlay" if="productSearch.isSearching">
        <div class="loading-spinner"></div>
      </div>

      <!-- Hero Section -->
      <section class="page-hero">
        <h1 class="page-title">
          ALL<br/>
          <span class="accent">PRODUCTS</span>
        </h1>
        <p class="page-subtitle">
          CURATED COLLECTION / LATEST DROPS / STUDIO EXCLUSIVES
        </p>
        
        <div class="stats-bar">
          <div class="stat-item">
            <span class="stat-value">{productSearch.totalCount}</span>
            <span class="stat-label">Total Items</span>
          </div>
          <div class="stat-item">
            <span class="stat-value">{productSearch.loadedCount}</span>
            <span class="stat-label">Showing</span>
          </div>
        </div>
      </section>

      <!-- Search -->
      <div class="search-section">
        <div class="search-box">
          <input 
            class="input input-lg" 
            type="text" 
            placeholder="SEARCH PRODUCTS..." 
            value="{productSearch.searchExpression}"
            ref="productSearch.searchExpression"
          />
          <button class="btn btn-ghost" ref="productSearch.clearSearchButton" title="Clear">
            X
          </button>
          <button class="btn btn-primary" ref="productSearch.searchButton">
            FIND
          </button>
        </div>
        
        <!-- Suggestions -->
        <div class="suggestions" if="productSearch.hasSuggestions">
          <button 
            class="suggestion-btn" 
            forEach="productSearch.suggestions" 
            trackBy="suggestionId"
            ref="productSearch.suggestions.suggestionButton"
          >
            {suggestionText}
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar">
          <div class="filters-header">
            <h3 class="section-title">FILTER</h3>
            <button class="btn btn-ghost btn-sm" ref="productSearch.filters.clearFilters">
              RESET
            </button>
          </div>

          <!-- Price Range -->
          <div class="filter-group">
            <label class="label">Price</label>
            <div class="price-inputs">
              <input 
                class="input" 
                type="number" 
                placeholder="MIN" 
                value="{productSearch.filters.priceRange.minPrice}"
                ref="productSearch.filters.priceRange.minPrice"
              />
              <input 
                class="input" 
                type="number" 
                placeholder="MAX" 
                value="{productSearch.filters.priceRange.maxPrice}"
                ref="productSearch.filters.priceRange.maxPrice"
              />
            </div>
          </div>

          <!-- Categories -->
          <div class="filter-group">
            <label class="label">Category</label>
            <div class="checkbox-group">
              <label 
                class="checkbox-item" 
                forEach="productSearch.filters.categoryFilter.categories" 
                trackBy="categoryId"
              >
                <input 
                  class="checkbox" 
                  type="checkbox"
                  ref="productSearch.filters.categoryFilter.categories.isSelected"
                />
                <span>{categoryName}</span>
              </label>
            </div>
          </div>

          <!-- Availability -->
          <div class="filter-group">
            <label class="label">Stock</label>
            <label class="checkbox-item">
              <input 
                class="checkbox" 
                type="checkbox"
                ref="productSearch.filters.inStockOnly"
              />
              <span>IN STOCK ONLY</span>
            </label>
          </div>
        </aside>

        <!-- Results Section -->
        <section class="results-section">
          <!-- Results Header -->
          <div class="results-header">
            <p class="results-count">
              <strong>{productSearch.loadedCount}</strong> OF <strong>{productSearch.totalCount}</strong> PRODUCTS
            </p>
            <select class="select" ref="productSearch.sortBy.sortDropdown">
              <option value="relevance">FEATURED</option>
              <option value="newest">NEWEST</option>
              <option value="priceAsc">PRICE: LOW → HIGH</option>
              <option value="priceDesc">PRICE: HIGH → LOW</option>
              <option value="nameAsc">A → Z</option>
              <option value="nameDesc">Z → A</option>
            </select>
          </div>

          <!-- Empty State -->
          <div class="empty-state" if="!productSearch.hasResults">
            <div class="empty-state-icon">∅</div>
            <h3 class="empty-state-title">NO RESULTS</h3>
            <p class="empty-state-message">{productSearch.emptyStateMessage}</p>
          </div>

          <!-- Products Grid -->
          <div class="products-grid-featured" if="productSearch.hasResults">
            <article class="product-card {isAddingToCart ? is-adding}" forEach="productSearch.searchResults" trackBy="_id">
              <a href="{productUrl}" class="product-card-image">
                <img 
                  src="{thumbnail.url}" 
                  alt="{thumbnail.altText}"
                  loading="lazy"
                />
                
                <!-- Hover Overlay -->
                <div class="product-image-overlay">
                  <h4 class="overlay-name">{name}</h4>
                  <span class="overlay-price">{actualPriceRange.minValue.formattedAmount}</span>
                </div>
                
                <!-- Badges -->
                <span class="badge badge-accent ribbon" if="hasRibbon">{ribbon.name}</span>
                <span class="badge badge-success stock-badge" if="inventory.availabilityStatus === IN_STOCK">
                  IN STOCK
                </span>
                <span class="badge badge-error stock-badge" if="inventory.availabilityStatus === OUT_OF_STOCK">
                  SOLD OUT
                </span>
              </a>
              <div class="product-card-content">
                <p class="product-card-brand" if="brand.name">{brand.name}</p>
                <h3 class="product-card-name">
                  <a href="{productUrl}" ref="productSearch.searchResults.productLink">{name}</a>
                </h3>
                <div class="product-card-price">
                  <span class="current-price">{actualPriceRange.minValue.formattedAmount}</span>
                  <span class="original-price" if="hasDiscount">
                    {compareAtPriceRange.minValue.formattedAmount}
                  </span>
                  <span class="badge badge-error" if="hasDiscount">SALE</span>
                </div>
                
                <!-- SIMPLE: Add to cart -->
                <button 
                  class="btn btn-secondary btn-block" 
                  ref="productSearch.searchResults.addToCartButton"
                  if="quickAddType === SIMPLE && inventory.availabilityStatus === IN_STOCK"
                >
                  ADD TO BAG
                </button>
                
                <!-- SINGLE_OPTION: Quick options -->
                <div class="quick-options-area" if="quickAddType === SINGLE_OPTION && inventory.availabilityStatus !== OUT_OF_STOCK">
                  <span class="select-option-hint">
                    SELECT {quickOption.name}
                  </span>
                  <div class="quick-options-buttons">
                    <button 
                      class="quick-option-btn {!inStock ? out-of-stock}"
                      forEach="quickOption.choices" 
                      trackBy="choiceId"
                      ref="productSearch.searchResults.quickOption.choices.choiceButton"
                      disabled="!inStock"
                    >
                      {name}
                    </button>
                  </div>
                </div>
                
                <!-- NEEDS_CONFIGURATION -->
                <a 
                  href="{productUrl}" 
                  class="btn btn-secondary btn-block"
                  ref="productSearch.searchResults.viewOptionsButton"
                  if="quickAddType === NEEDS_CONFIGURATION && inventory.availabilityStatus !== OUT_OF_STOCK"
                >
                  SELECT OPTIONS
                </a>
                
                <!-- Out of stock -->
                <button 
                  class="btn btn-ghost btn-block" 
                  disabled
                  if="inventory.availabilityStatus === OUT_OF_STOCK"
                >
                  SOLD OUT
                </button>
              </div>
            </article>
          </div>

          <!-- Load More -->
          <div class="pagination-section" if="productSearch.hasResults">
            <div class="loading-indicator" if="productSearch.isSearching">
              <div class="loading-spinner-inline"></div>
              <span>LOADING...</span>
            </div>

            <button 
              class="btn btn-secondary" 
              ref="productSearch.loadMoreButton"
              if="productSearch.hasMore && !productSearch.isSearching"
            >
              LOAD MORE
            </button>
            
            <span class="pagination-info" if="!productSearch.hasMore && productSearch.totalCount > 0">
              ALL PRODUCTS LOADED
            </span>
          </div>
        </section>
      </div>
    </div>
  </body>
</html>
