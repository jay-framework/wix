<html>
  <head>
    <script type="application/jay-headless"
            plugin="@jay-framework/wix-stores"
            contract="product-search"
            key="productSearch"
    ></script>
    <script type="application/jay-headless"
            plugin="@jay-framework/wix-stores"
            contract="cart-indicator"
            key="cartIndicator"
    ></script>
    <script type="application/jay-data">
      data:
    </script>
    <link rel="stylesheet" href="../../styles/store-theme.css" />
    <style>
      /* Page-specific layout */
      .search-page {
        max-width: var(--container-max);
        margin: 0 auto;
        padding: 40px var(--page-padding);
      }

      .page-header {
        text-align: center;
        margin-bottom: var(--section-gap);
      }

      .page-header .page-subtitle {
        max-width: 600px;
        margin: 16px auto 0;
      }

      .search-section {
        max-width: var(--container-narrow);
        margin: 0 auto var(--section-gap);
      }

      .main-content {
        display: grid;
        grid-template-columns: 280px 1fr;
        gap: 32px;
      }

      .results-section {
        display: flex;
        flex-direction: column;
        gap: 24px;
      }

      .results-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .results-count {
        font-size: 16px;
        color: var(--text-secondary);
      }

      .results-count span {
        color: var(--text-primary);
        font-weight: 600;
      }

      /* Product card wrapper - contains both image and content */
      /*.product-card-wrapper {*/
      /*  display: contents;*/
      /*}*/

      @media (max-width: 1024px) {
        .main-content {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="search-page">
      <!-- Site Header with Cart -->
      <header class="site-header">
        <a href="/products" class="site-logo">Store<span>.</span></a>
        <nav class="site-nav">
          <a href="/products">Products</a>
          <a href="/cart" 
             class="cart-indicator {cartIndicator.hasItems ? has-items} {cartIndicator.isLoading ? is-loading} {cartIndicator.justAdded ? just-added}"
             ref="cartIndicator.cartLink">
            <span class="cart-indicator-icon">üõí</span>
            <span class="cart-indicator-count" if="cartIndicator.hasItems">{cartIndicator.itemCount}</span>
          </a>
        </nav>
      </header>

      <!-- Loading Overlay -->
      <div class="loading-overlay" if="productSearch.isSearching">
        <div class="loading-spinner"></div>
      </div>
      <!-- Page Header -->
      <header class="page-header">
        <h1 class="page-title">Discover Products</h1>
        <p class="page-subtitle">Explore our curated collection of amazing products. Use the search and filters to find exactly what you're looking for.</p>
      </header>

      <!-- Search Section -->
      <div class="search-section">
        <div class="search-box">
          <input 
            class="input input-lg" 
            type="text" 
            placeholder="Search for products..." 
            value="{productSearch.searchExpression}"
            ref="productSearch.searchExpression"
          />
          <button class="btn btn-ghost" ref="productSearch.clearSearchButton" title="Clear search">
            ‚úï
          </button>
          <button class="btn btn-primary" ref="productSearch.searchButton">
            üîç Search
          </button>
        </div>

        <!-- Suggestions -->
        <div class="suggestions" if="productSearch.hasSuggestions">
          <button 
            class="suggestion-btn" 
            forEach="productSearch.suggestions" 
            trackBy="suggestionId"
            ref="productSearch.suggestions.suggestionButton"
          >
            {suggestionText}
          </button>
        </div>
      </div>

      <!-- Main Content -->
      <div class="main-content">
        <!-- Filters Sidebar -->
        <aside class="filters-sidebar">
          <div class="filters-header">
            <h3 class="section-title" style="font-size: 18px;">Filters</h3>
            <button class="btn btn-ghost btn-sm" ref="productSearch.filters.clearFilters">
              Clear All
            </button>
          </div>

          <!-- Price Range -->
          <div class="filter-group">
            <label class="label">Price Range</label>
            <div class="price-inputs">
              <input 
                class="input" 
                type="number" 
                placeholder="Min" 
                value="{productSearch.filters.priceRange.minPrice}"
                ref="productSearch.filters.priceRange.minPrice"
              />
              <input 
                class="input" 
                type="number" 
                placeholder="Max" 
                value="{productSearch.filters.priceRange.maxPrice}"
                ref="productSearch.filters.priceRange.maxPrice"
              />
            </div>
          </div>

          <!-- Categories -->
          <div class="filter-group">
            <label class="label">Categories</label>
            <div class="checkbox-group">
              <label 
                class="checkbox-item" 
                forEach="productSearch.filters.categoryFilter.categories" 
                trackBy="categoryId"
              >
                <input 
                  class="checkbox" 
                  type="checkbox"
                  ref="productSearch.filters.categoryFilter.categories.isSelected"
                />
                <span>{categoryName}</span>
              </label>
            </div>
          </div>

          <!-- In Stock Only -->
          <div class="filter-group">
            <label class="checkbox-item">
              <input 
                class="checkbox" 
                type="checkbox"
                ref="productSearch.filters.inStockOnly"
              />
              <span>In Stock Only</span>
            </label>
          </div>

          <button class="btn btn-primary btn-block" ref="productSearch.filters.applyFilters" style="margin-top: 24px;">
            Apply Filters
          </button>
        </aside>

        <!-- Results Section -->
        <section class="results-section">
          <!-- Results Header -->
          <div class="results-header">
            <p class="results-count">
              Showing <span>{productSearch.resultCount}</span> products
            </p>
            <select class="select" ref="productSearch.sortBy.sortDropdown">
              <option value="relevance">Most Relevant</option>
              <option value="newest">Newest First</option>
              <option value="priceAsc">Price: Low to High</option>
              <option value="priceDesc">Price: High to Low</option>
              <option value="nameAsc">Name: A to Z</option>
              <option value="nameDesc">Name: Z to A</option>
            </select>
          </div>

          <!-- Empty State -->
          <div class="empty-state" if="!productSearch.hasResults">
            <div class="empty-state-icon">üîç</div>
            <h3 class="empty-state-title">No Products Found</h3>
            <p class="empty-state-message">{productSearch.emptyStateMessage}</p>
          </div>

          <!-- Products Grid -->
          <div class="products-grid" if="productSearch.hasResults">
            <article class="product-card {isAddingToCart ? is-adding}" forEach="productSearch.searchResults" trackBy="_id">
              <div class="product-card-wrapper">
                <a href="{productUrl}" class="product-card-image">
                  <img 
                    src="{thumbnail.url}" 
                    alt="{thumbnail.altText}"
                    loading="lazy"
                  />
                  
                  <!-- Badges -->
                  <span class="badge badge-accent ribbon" if="hasRibbon">{ribbon.name}</span>
                  <span class="badge badge-success stock-badge" if="inventory.availabilityStatus === IN_STOCK">
                    In Stock
                  </span>
                  <span class="badge badge-error stock-badge" if="inventory.availabilityStatus === OUT_OF_STOCK">
                    Out of Stock
                  </span>
                </a>
                <div class="product-card-content">
                  <p class="product-card-brand" if="brand.name">{brand.name}</p>
                  <h3 class="product-card-name">
                    <a href="{productUrl}" ref="productSearch.searchResults.productLink">{name}</a>
                  </h3>
                  <div class="product-card-price">
                    <span class="current-price">{actualPriceRange.minValue.formattedAmount}</span>
                    <span class="original-price" if="hasDiscount">
                      {compareAtPriceRange.minValue.formattedAmount}
                    </span>
                    <span class="badge badge-error" if="hasDiscount">Sale</span>
                  </div>
                  
                  <!-- SIMPLE: Regular add to cart -->
                  <button 
                    class="btn btn-secondary btn-block" 
                    ref="productSearch.searchResults.addToCartButton"
                    if="quickAddType === SIMPLE && inventory.availabilityStatus === IN_STOCK"
                  >
                    Add to Cart
                  </button>
                  
                  <!-- SINGLE_OPTION: Quick option selection in button area -->
                  <div class="quick-options-area" if="quickAddType === SINGLE_OPTION && inventory.availabilityStatus !== OUT_OF_STOCK">
                    <!-- Default: "Select {option}" hint -->
                    <span class="select-option-hint">
                      Select {quickOption.name}
                    </span>
                    <!-- Hover: Show option buttons -->
                    <div class="quick-options-buttons">
                      <button 
                        class="quick-option-btn {!inStock ? out-of-stock}"
                        forEach="quickOption.choices" 
                        trackBy="choiceId"
                        ref="productSearch.searchResults.quickOption.choices.choiceButton"
                        disabled="{!inStock}"
                      >
                        {name}
                      </button>
                    </div>
                  </div>
                  
                  <!-- NEEDS_CONFIGURATION: Link to product page -->
                  <a 
                    href="{productUrl}" 
                    class="btn btn-secondary btn-block"
                    ref="productSearch.searchResults.viewOptionsButton"
                    if="quickAddType === NEEDS_CONFIGURATION && inventory.availabilityStatus !== OUT_OF_STOCK"
                  >
                    View Options
                  </a>
                  
                  <!-- Out of stock (any type) -->
                  <button 
                    class="btn btn-ghost btn-block" 
                    disabled="true"
                    if="inventory.availabilityStatus === OUT_OF_STOCK"
                  >
                    Out of Stock
                  </button>
                </div>
              </div>
            </article>
          </div>

          <!-- Pagination -->
          <div class="pagination" if="productSearch.hasResults">
            <button 
              class="btn btn-ghost" 
              ref="productSearch.pagination.prevButton"
              disabled="{!productSearch.pagination.hasPrevPage}"
            >
              ‚Üê Previous
            </button>
            <span class="pagination-info">
              Page {productSearch.pagination.currentPage} of {productSearch.pagination.totalPages}
            </span>
            <button 
              class="btn btn-ghost" 
              ref="productSearch.pagination.nextButton"
              disabled="{!productSearch.pagination.hasNextPage}"
            >
              Next ‚Üí
            </button>
          </div>

          <!-- Load More (Alternative) -->
          <button 
            class="btn btn-secondary" 
            style="max-width: 300px; margin: 0 auto;"
            if="productSearch.pagination.hasNextPage"
            ref="productSearch.pagination.loadMoreButton"
          >
            Load More Products
          </button>
        </section>
      </div>
    </div>
  </body>
</html>

